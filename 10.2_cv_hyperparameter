

##############################################
# 1. íŒ¨í‚¤ì§€ ë¡œë“œ
##############################################
library(dplyr)
library(randomForest)
library(caret)        # êµì°¨ê²€ì¦ + íŠœë‹ìš©
library(Metrics)

##############################################
# 2. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì „ì²˜ë¦¬
##############################################
rdata <- read.csv("gas.csv")

# ê²°ì¸¡ì¹˜ ì œê±° + 0ê°’ ì œê±° (ë¬¸ì œ ìš”êµ¬ì‚¬í•­)
data <- rdata %>%
  na.omit() %>%
  filter(roof != 0, wall != 0, cooling != 0, heating != 0)

##############################################
# 3. í•™ìŠµ/í‰ê°€(8:2) ë°ì´í„° ë¶„ë¦¬
##############################################
set.seed(42)
idx <- sample(1:nrow(data), nrow(data)*0.8)
train <- data[idx, ]
test  <- data[-idx, ]

##############################################
# 4. êµì°¨ê²€ì¦ + í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì •
##############################################
# (1) êµì°¨ê²€ì¦: 3-fold â†’ ë¹ ë¥´ê³  ì•ˆì •ì 
ctrl <- trainControl(method = "cv", number = 3)

# (2) í•˜ì´í¼íŒŒë¼ë¯¸í„° ê·¸ë¦¬ë“œ ì •ì˜ (ì‹œí—˜ìš©ìœ¼ë¡œ ê°„ë‹¨)
# mtry = ëœë¤í¬ë ˆìŠ¤íŠ¸ê°€ ë…¸ë“œ ë¶„í•  ì‹œ ê³ ë ¤í•  ë³€ìˆ˜ ìˆ˜
tune_grid <- expand.grid(mtry = c(2, 3, 4))

##############################################
# 5. íŠœë‹ëœ ëœë¤í¬ë ˆìŠ¤íŠ¸ ëª¨ë¸ í•™ìŠµ
##############################################
set.seed(42)
model_tuned <- train(
  gas ~ .,             # ë¬¸ì œì™€ ë™ì¼: gasë¥¼ ì„¤ëª…í•˜ëŠ” ëª¨ë“  ë³€ìˆ˜ ì‚¬ìš©
  data = train,
  method = "rf",       # randomForest ì‚¬ìš©
  metric = "RMSE",     # í‰ê°€ ê¸°ì¤€: RMSE ìµœì†Œí™”
  trControl = ctrl,    # êµì°¨ê²€ì¦ ì„¤ì •
  tuneGrid = tune_grid,# í•˜ì´í¼íŒŒë¼ë¯¸í„° í›„ë³´
  ntree = 300          # íŠ¸ë¦¬ ê°œìˆ˜(ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼)
)

##############################################
# 6. íŠœë‹ ê²°ê³¼ í™•ì¸
##############################################
print(model_tuned)
cat("ì„ íƒëœ ìµœì  mtry:", model_tuned$bestTune$mtry, "\n\n")

##############################################
# 7. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ìµœì¢… ì„±ëŠ¥ í‰ê°€
##############################################
pred_tuned <- predict(model_tuned, newdata=test)
rmse_tuned <- rmse(test$gas, pred_tuned)

cat("íŠœë‹ëœ ëª¨ë¸ì˜ ìµœì¢… RMSE:", round(rmse_tuned, 3), "\n\n")

##############################################
# 8. ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥
##############################################
result <- data.frame(
  actual_gas = test$gas,
  predicted_gas = pred_tuned
)

write.csv(result, "gas_result_tuned.csv", row.names=FALSE)
cat("'gas_result_tuned.csv' íŒŒì¼ë¡œ ì €ì¥ ì™„ë£Œ!\n")


############################################################################################################################
ì•„ì£¼ ì¢‹ì•„ìš”!
ì§€ê¸ˆ ì˜¬ë ¤ì¤€ baseline ì½”ë“œ íë¦„ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©´ì„œ
âœ“ êµì°¨ê²€ì¦(CV) ì ìš©
âœ“ í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹(mtry) ì ìš©
âœ“ ì‹¤í–‰ì‹œê°„ ë¹ ë¥¸ êµ¬ì¡°
âœ“ ì‹œí—˜ì—ì„œ ìš”êµ¬í•˜ëŠ” ì¹œì ˆí•œ í•œê¸€ ì£¼ì„
ìœ¼ë¡œ ë°”ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•œ ìµœì í™”(coach-friendly) ì½”ë“œë¥¼ ë§Œë“¤ì–´ ë“œë¦½ë‹ˆë‹¤.


---

âœ… ë‹¹ì‹  ì½”ë“œ ê¸°ë°˜ ë§ì¶¤í˜•: êµì°¨ê²€ì¦ + í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì½”ë“œ

##############################################
# 1. íŒ¨í‚¤ì§€ ë¡œë“œ
##############################################
library(dplyr)
library(randomForest)
library(caret)        # êµì°¨ê²€ì¦ + íŠœë‹ìš©
library(Metrics)

##############################################
# 2. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì „ì²˜ë¦¬
##############################################
rdata <- read.csv("gas.csv")

# ê²°ì¸¡ì¹˜ ì œê±° + 0ê°’ ì œê±° (ë¬¸ì œ ìš”êµ¬ì‚¬í•­)
data <- rdata %>%
  na.omit() %>%
  filter(roof != 0, wall != 0, cooling != 0, heating != 0)

##############################################
# 3. í•™ìŠµ/í‰ê°€(8:2) ë°ì´í„° ë¶„ë¦¬
##############################################
set.seed(42)
idx <- sample(1:nrow(data), nrow(data)*0.8)
train <- data[idx, ]
test  <- data[-idx, ]

##############################################
# 4. êµì°¨ê²€ì¦ + í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹ ì„¤ì •
##############################################
# (1) êµì°¨ê²€ì¦: 3-fold â†’ ë¹ ë¥´ê³  ì•ˆì •ì 
ctrl <- trainControl(method = "cv", number = 3)

# (2) í•˜ì´í¼íŒŒë¼ë¯¸í„° ê·¸ë¦¬ë“œ ì •ì˜ (ì‹œí—˜ìš©ìœ¼ë¡œ ê°„ë‹¨)
# mtry = ëœë¤í¬ë ˆìŠ¤íŠ¸ê°€ ë…¸ë“œ ë¶„í•  ì‹œ ê³ ë ¤í•  ë³€ìˆ˜ ìˆ˜
tune_grid <- expand.grid(mtry = c(2, 3, 4))

##############################################
# 5. íŠœë‹ëœ ëœë¤í¬ë ˆìŠ¤íŠ¸ ëª¨ë¸ í•™ìŠµ
##############################################
set.seed(42)
model_tuned <- train(
  gas ~ .,             # ë¬¸ì œì™€ ë™ì¼: gasë¥¼ ì„¤ëª…í•˜ëŠ” ëª¨ë“  ë³€ìˆ˜ ì‚¬ìš©
  data = train,
  method = "rf",       # randomForest ì‚¬ìš©
  metric = "RMSE",     # í‰ê°€ ê¸°ì¤€: RMSE ìµœì†Œí™”
  trControl = ctrl,    # êµì°¨ê²€ì¦ ì„¤ì •
  tuneGrid = tune_grid,# í•˜ì´í¼íŒŒë¼ë¯¸í„° í›„ë³´
  ntree = 300          # íŠ¸ë¦¬ ê°œìˆ˜(ê¸°ì¡´ ì½”ë“œì™€ ë™ì¼)
)

##############################################
# 6. íŠœë‹ ê²°ê³¼ í™•ì¸
##############################################
print(model_tuned)
cat("ì„ íƒëœ ìµœì  mtry:", model_tuned$bestTune$mtry, "\n\n")

##############################################
# 7. í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ìµœì¢… ì„±ëŠ¥ í‰ê°€
##############################################
pred_tuned <- predict(model_tuned, newdata=test)
rmse_tuned <- rmse(test$gas, pred_tuned)

cat("íŠœë‹ëœ ëª¨ë¸ì˜ ìµœì¢… RMSE:", round(rmse_tuned, 3), "\n\n")

##############################################
# 8. ì˜ˆì¸¡ ê²°ê³¼ ì €ì¥
##############################################
result <- data.frame(
  actual_gas = test$gas,
  predicted_gas = pred_tuned
)

write.csv(result, "gas_result_tuned.csv", row.names=FALSE)
cat("'gas_result_tuned.csv' íŒŒì¼ë¡œ ì €ì¥ ì™„ë£Œ!\n")


---

âœ… ì´ ì½”ë“œì˜ íŠ¹ì§• (ì‹œí—˜ ëŒ€ë¹„ ìµœì í™”)

âœ” ê¸°ì¡´ ë„ˆì˜ ì½”ë“œ íë¦„ ìœ ì§€

gas~. êµ¬ì¡° ê·¸ëŒ€ë¡œ ì‚¬ìš©

train/test 8:2 ë°©ì‹ ìœ ì§€

ntree=300 ê·¸ëŒ€ë¡œ ìœ ì§€


âœ” ì¶”ê°€ëœ ê¸°ëŠ¥

êµì°¨ê²€ì¦(cv=3)

í•˜ì´í¼íŒŒë¼ë¯¸í„°(mtry = 2,3,4) ìë™ ì„ íƒ

caret íŒ¨í‚¤ì§€ ì‚¬ìš©ìœ¼ë¡œ ê²°ê³¼ë¬¼ì´ ê¹”ë”í•˜ê³  ëª…í™•


âœ” ì‹œí—˜ ëŒ€ë¹„ ì‹¤í–‰ì‹œê°„ ìµœì 

grid 3ê°œ Ã— cv-fold 3 = ì´ 9íšŒ í•™ìŠµ

ntree = 300ì€ ë¹ ë¥´ê²Œ ëŒì•„ê°€ëŠ” ì•ˆì „í•œ ê°’



---

âœ” ê²°ê³¼ íŒŒì¼

ì˜ˆì¸¡ê°’ì´ ë‹´ê¸´ CSV: gas_result_tuned.csv

ì†Œìˆ˜ì  3ìë¦¬ê¹Œì§€ RMSE ì¶œë ¥



---

í•„ìš”í•˜ë©´
ğŸ“Œ mtry ë²”ìœ„ë¥¼ ë„“íˆëŠ” ì½”ë“œ,
ğŸ“Œ ntreeë¥¼ íŠœë‹í•˜ëŠ” ì½”ë“œ,
ğŸ“Œ feature importance ì‹œê°í™”,
ğŸ“Œ baseline vs tuned ì„±ëŠ¥ ë¹„êµí‘œ
ë„ ë§Œë“¤ì–´ ì¤„ê²Œ.

ë‹¤ìŒì€ ë¬´ì—‡ì„ ë„ì™€ì¤„ê¹Œ?

############################################################################################################################
